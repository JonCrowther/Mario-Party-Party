<!DOCTYPE html>
<html>
<style>
.option {
    width: 800px;
    height: 200px;
    line-height: 200px;
    position: relative;
    background: lightblue;
    margin: auto;
    width: 50%;
    text-align: center;
    font-size: x-large;
}
.highlighted {
    background: darkblue;
}
.gameButton {
    width: 200px;
    margin: auto;
    display: inline;
}
.spinButton {
    width: 200px;
    margin: auto;
    display: inline;
}
.gameTypes {
    margin: auto;
    width: 50%;
    border: 3px solid green;
    padding: 10px;
    display: flex;
    justify-content: space-between;
}
.center {
    margin: auto;
    width: 50%;
    border: 3px solid green;
    padding: 10px;
    display: flex;
    justify-content: center;
}

</style>
<body>

<div class="gameTypes">
    <button class="gameButton" onclick="displayDuels()">Duel</button>
    <button class="gameButton" onclick="display4Player()">4 Person</button>
    <button class="gameButton" onclick="displaySolo()">Solo</button>
</div>

<!-- TODO: Make this wheel stay the same size no matter the options -->
<div id ="wheel" padding="10px">
    <div class="option"><p>Option1</p></div>
    <div class="option"><p>Option2</p></div>
    <div class="option"><p>Option3</p></div>
    <div class="option"><p>Option4</p></div>
</div>

<div class="center">
    <p><button onclick="selectGame()" class="spinButton">Click Me</button></p>
</div>

<script>
const UNKNOWN_TITLE="???????";

// selectUnique returns an array of length toSelect that contain unique random numbers in the provided range
function selectUnique(toSelect, range) {
    var arr = [];
    while(arr.length < toSelect){
        var r = Math.floor(Math.random() * range);
        if(arr.indexOf(r) === -1) arr.push(r);
    }
    return arr;
}

// buildOptionHTML builds the html for the options provided
//   gameMap: map of all games
//   games: array of game numbers to choose (generated from selectUnique)
//   type: name of game type. Used to populate "data-type" attribute
function buildOptionHTML(gameMap, games, type) {
    var html = "";
    for (var i = 0; i < games.length; i++) {
        let game = gameMap.get(games[i]);
        let name = "";
        if (game.seen) {
            name = game.name;
        } else {
            name = UNKNOWN_TITLE;
        }
        html += '<div class="option" data-game="' + games[i] + '" data-type="' + type + '"><p>' + name + '</p></div>';
    }
    return html;
}

// displayOptions updates the options to be displayed
function displayOptions(optionsDisplayed, gamesMap, gameType) {
    var arr = selectUnique(optionsDisplayed, gamesMap.size);
    console.log(arr);

    var html = buildOptionHTML(gamesMap, arr, gameType);
    console.log(html);

    document.getElementById("wheel").innerHTML = html;
}

const DUELS_DISPLAYED = 4;
const DUEL_TYPE = "duel";
const DUEL_GAMES = new Map([
    [0, {name: "Duel Game #1", seen: false}],
    [1, {name: "Duel Game #2", seen: false}],
    [2, {name: "Duel Game #3", seen: false}],
    [3, {name: "Duel Game #4", seen: false}],
    [4, {name: "Duel Game #5", seen: false}],
    [5, {name: "Duel Game #6", seen: false}],
    [6, {name: "Duel Game #7", seen: false}],
    [7, {name: "Duel Game #8", seen: false}],
    [8, {name: "Duel Game #9", seen: false}],
]);
function displayDuels() {
    displayOptions(DUELS_DISPLAYED, DUEL_GAMES, DUEL_TYPE);
}

const SOLOS_DISPLAYED = 3;
const SOLOS_TYPE = "solo";
const SOLO_GAMES = new Map([
    [0, {name: "Solo Game #1", seen: false}],
    [1, {name: "Solo Game #2", seen: false}],
    [2, {name: "Solo Game #3", seen: false}],
    [3, {name: "Solo Game #4", seen: false}],
    [4, {name: "Solo Game #5", seen: false}],
    [5, {name: "Solo Game #6", seen: false}],
    [6, {name: "Solo Game #7", seen: false}],
])
function displaySolo() {
    displayOptions(SOLOS_DISPLAYED, SOLO_GAMES, SOLOS_TYPE);
}

const FOURS_DISPLAYED = 4;
const FOURS_TYPE = "four";
const FOUR_GAMES = new Map([
    [0, {name: "4 Player Game #1", seen: false}],
    [1, {name: "4 Player Game #2", seen: false}],
    [2, {name: "4 Player Game #3", seen: false}],
    [3, {name: "4 Player Game #4", seen: false}],
    [4, {name: "4 Player Game #5", seen: false}],
    [5, {name: "4 Player Game #6", seen: false}],
])
function display4Player() {
    displayOptions(FOURS_DISPLAYED, FOUR_GAMES, FOURS_TYPE);
}

// Variables for configuring the selector settings
const ITERATIONS = 60;
const START_SPEED = 5;
const SPEED_BASE = 1.04;
const FLASHES = 8;
const FLASH_SPEED = 100;

// selectGame randomly selects a game from the list currently visible
function selectGame() {
    // Start at a random position
    let numOpts = document.getElementsByClassName("option").length;
    let position = Math.floor(Math.random()*numOpts);
    const iterations = ITERATIONS + position;
    
    let id = null;
    let speed = START_SPEED;
    clearInterval(id);
    id = setInterval(cycle_options, speed);
    
    // cycle the highlighted option. The winner is already chosen, but this makes it fun
    function cycle_options() {
        if (position == iterations) {
            clearInterval(id);
            winner();
        } else {
            // deselect currently highlighted option
            var highlighted = document.getElementsByClassName("highlighted");
            for (var i = 0; i < highlighted.length; i++) {
                highlighted[i].setAttribute("class","option");
            }
            
            // highlight our new option
            var opts = document.getElementsByClassName("option");
            opts[position%numOpts].setAttribute("class", "highlighted option");
            position++;

            // increase the interval at which we cycle through the options exponentially
            // gives it a nice "slowing down" feel. Linear doesn't feel as nice
            speed += Math.pow(SPEED_BASE, position);
            clearInterval(id);
            id = setInterval(cycle_options, speed);
        }
    }

    // make the winning option flash. Note: FLASH_SPEED needs to be even, otherwise the winner ends up de-highlighted
    function winner() {
        id = setInterval(flash, FLASH_SPEED);
        let i = 0;
        let choice = document.getElementsByClassName("highlighted")[0]
        
        // reveal the choice if it hasn't been revealed yet
        if (choice.textContent == UNKNOWN_TITLE) {
            num = choice.getAttribute("data-game");
            game = null;
            switch(choice.getAttribute("data-type")) {
                case DUEL_TYPE:
                    game = DUEL_GAMES.get(parseInt(num));
                    game.seen = true;
                    DUEL_GAMES.set(parseInt(num), game);
                    break;
                case SOLOS_TYPE:
                    game = SOLO_GAMES.get(parseInt(num));
                    game.seen = true;
                    SOLO_GAMES.set(parseInt(num), game);
                    break;
                case FOURS_TYPE:
                    game = FOUR_GAMES.get(parseInt(num));
                    game.seen = true;
                    FOUR_GAMES.set(parseInt(num), game);
                    break;
            }
            choice.textContent = game.name;
        }
        function flash() {
            if (i == FLASHES) {
                clearInterval(id);
            } else {
                let myClass = choice.getAttribute("class");
                if (myClass == "highlighted option") {
                    choice.setAttribute("class","option");
                } else {
                    choice.setAttribute("class","highlighted option");
                }
                i++;
            }
        }
    }
}
</script>
</body>
</html>